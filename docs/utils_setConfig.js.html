<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: utils/setConfig.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: utils/setConfig.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>'use strict';

const fs = require('fs');
const path = require('path');
const userHome = require('user-home');
const pathIsAbsolute = require('path-is-absolute');
const stripJsonComments = require('strip-json-comments');
const Glob = require('glob').Glob;

/**
 * @description Sets the return config if one if found.
 * @param  {string} configPath - Where to look for config.
 * @returns {Object|void} Object if stylintrc found, undefined if not.
 */
function parseConfig(configPath) {
  return JSON.parse(
    stripJsonComments(
      fs.readFileSync(configPath, 'utf-8')
    )
  );
}

/**
 * @description Reverse walk from cwd to usr.
 *              If .stylintrc found, use it.
 * @param  {Array&lt;string>} files - All files for this dir level.
 * @param  {number} level - Number of dirs traversed so far.
 * @param  {string} cwd  - Relative path to current directory being walked.
 * @returns {?Object|?Function} Config if found, recurse if not. null if failed.
 */
function recurseDirectories(files, level, cwd) {
  let localLevel = level;

  // parse stylintrc if found, stop recursion
  if (files.indexOf('.stylintrc') !== -1) {
    return parseConfig(`${cwd}/.stylintrc`);
  }

  // only go up to user home directory, stop recursion
  if (userHome) return null;

  // next dir level
  const nextLevel = level + 1;
  // pathArr is generated by applying our dir level
  // to cwd, and going backwards
  // ie, level = 1, pathArr = [ cwd, '..' ]
  // ie, level = 2, pathArr = [ cwd, '..', '..' ]
  // and so on
  const pathArr = [cwd];

  // push '..' for each dir level
  while (localLevel--) {
    pathArr.push('..');
  }

  // creates the path to the next directory
  const newPath = path.join.apply(null, pathArr);
  // gets the files for the next directory
  const newFiles = fs.readdirSync(newPath);
  // passes the newFiles, nextLevel, and newPath to itself
  // to start the process over again
  return recurseDirectories(newFiles, nextLevel, newPath);
}

// @TODO i just this sloppy just to fix some stuff
// comes back and refactor / cleanup

/**
 * @description Overrides default config with a new config object.
 *              Many potential code paths here.
 * 1: user passed in config object via function param
 * 2: user passes location of .stylintrc file to use via cli
 * 3: user has options obj in package.json or path to
 * 4: none of the above, fallback to initial config
 * 5: user has a .stylintrc file in a dir but doesnt pass anything
 * @param {string} [configpath] - If defined, the path to a config-file to read.
 * @returns {Function} Kick off linter again.
 */
const setConfig = function (configpath) {
  let files = [];
  let customPath = '';
  // return default config if nothing passed in or found
  let returnConfig;
  const cwd = process.cwd();
  let pkg = null;
  try {
    // TODO: Use pkg-up
    // eslint-disable-next-line import/no-dynamic-require
    pkg = require(`${cwd}/package.json`);
  }
  catch (err) {
    // no output
  }

  // if 1, the customConfig will be what we want
  // this only occurs if using stylint programmatically
  // ie, user passed in option object
  if (this.customConfig) {
    returnConfig = this.customConfig;
  }
  // if 2, we pass in a path to the config
  // this only occurs if using stylint via the command line
  else if (configpath) {
    customPath = pathIsAbsolute(configpath) ? configpath : `${cwd}/${configpath}`;
    try {
      returnConfig = parseConfig(customPath);
    }
    catch (err) {
      throw err;
    }
  }
  // 3, if user did not pass in option obj, or pass options via cli
  // check the user's package.json for either an option obj, or
  // at least a path to one
  else if (pkg !== null &amp;&amp;
    typeof pkg.stylintrc !== 'undefined') {
    const rc = pkg.stylintrc;

    if (typeof rc === 'object' &amp;&amp; !(rc instanceof Array)) {
      returnConfig = rc;
    }
    else if (typeof rc === 'string') {
      returnConfig = parseConfig(rc);
    }
  }
  // 4, nothing passed in via cli or programmatically or via pkg
  // start at cwd, walk up to user home directory, if nothing
  // found, then just use the default config
  else {
    try {
      // recurse up to user home
      files = fs.readdirSync(cwd);
      // null if .stylintrc file found anywhere
      returnConfig = recurseDirectories(files, 1, cwd);

      // default config if nothing found
      if (!returnConfig) {
        returnConfig = this.config;
      }
    }
      // in case there's an issue parsing or no .stylintrc found at specified location
    catch (err) {
      throw err;
    }
  }

  returnConfig.exclude = (returnConfig.exclude || []).map(exclude => new Glob(exclude, {
    matchBase: true,
  }).minimatch);

  // make sure indentPref is set no matter what
  returnConfig.indentPref = returnConfig.indentPref || false;

  // 5, just return the default config if nothing found
  return returnConfig;
};

module.exports = setConfig;
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#blocks">blocks</a></li><li><a href="global.html#brackets">brackets</a></li><li><a href="global.html#checkPrefix">checkPrefix</a></li><li><a href="global.html#checkPseudo">checkPseudo</a></li><li><a href="global.html#colons">colons</a></li><li><a href="global.html#colors">colors</a></li><li><a href="global.html#commaSpace">commaSpace</a></li><li><a href="global.html#commentSpace">commentSpace</a></li><li><a href="global.html#config">config</a></li><li><a href="global.html#cssLiteral">cssLiteral</a></li><li><a href="global.html#depthLimit">depthLimit</a></li><li><a href="global.html#done">done</a></li><li><a href="global.html#duplicates">duplicates</a></li><li><a href="global.html#efficient">efficient</a></li><li><a href="global.html#extendPref">extendPref</a></li><li><a href="global.html#getFiles">getFiles</a></li><li><a href="global.html#hashEnd">hashEnd</a></li><li><a href="global.html#hashStart">hashStart</a></li><li><a href="global.html#indentPref">indentPref</a></li><li><a href="global.html#init">init</a></li><li><a href="global.html#keyframesEnd">keyframesEnd</a></li><li><a href="global.html#keyframesStart">keyframesStart</a></li><li><a href="global.html#leadingZero">leadingZero</a></li><li><a href="global.html#lint">lint</a></li><li><a href="global.html#lintString">lintString</a></li><li><a href="global.html#mixed">mixed</a></li><li><a href="global.html#msg">msg</a></li><li><a href="global.html#namingConvention">namingConvention</a></li><li><a href="global.html#noImportant">noImportant</a></li><li><a href="global.html#none">none</a></li><li><a href="global.html#parenSpace">parenSpace</a></li><li><a href="global.html#parse">parse</a></li><li><a href="global.html#parseConfig">parseConfig</a></li><li><a href="global.html#placeholders">placeholders</a></li><li><a href="global.html#prefixVarsWithDollar">prefixVarsWithDollar</a></li><li><a href="global.html#quotePref">quotePref</a></li><li><a href="global.html#read">read</a></li><li><a href="global.html#recurseDirectories">recurseDirectories</a></li><li><a href="global.html#reporter">reporter</a></li><li><a href="global.html#resetOnChange">resetOnChange</a></li><li><a href="global.html#rootEnd">rootEnd</a></li><li><a href="global.html#rootStart">rootStart</a></li><li><a href="global.html#semicolons">semicolons</a></li><li><a href="global.html#setConfig">setConfig</a></li><li><a href="global.html#setContext">setContext</a></li><li><a href="global.html#setState">setState</a></li><li><a href="global.html#sortOrder">sortOrder</a></li><li><a href="global.html#splitAndStrip">splitAndStrip</a></li><li><a href="global.html#stackedProperties">stackedProperties</a></li><li><a href="global.html#startsWithComment">startsWithComment</a></li><li><a href="global.html#state">state</a></li><li><a href="global.html#stylintOff">stylintOff</a></li><li><a href="global.html#stylintOn">stylintOn</a></li><li><a href="global.html#trailingWhitespace">trailingWhitespace</a></li><li><a href="global.html#transformMessages">transformMessages</a></li><li><a href="global.html#trimLine">trimLine</a></li><li><a href="global.html#universal">universal</a></li><li><a href="global.html#watch">watch</a></li><li><a href="global.html#zeroUnits">zeroUnits</a></li><li><a href="global.html#zIndexNormalize">zIndexNormalize</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.2</a> on Tue Oct 11 2016 00:07:08 GMT+0200 (CEST)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
